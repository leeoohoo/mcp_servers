# File Write Server

基于 MCP Framework 的文件修改服务器，提供精准的基于行号的文本修改功能。

## 功能特性

### 核心功能
- **单行修改**: 精确修改指定行号的内容
- **范围修改**: 批量修改指定行范围的内容
- **插入行**: 在指定位置插入新的行内容
- **删除行**: 删除指定范围的行
- **批量修改**: 一次性修改多个不连续的行
- **查看内容**: 查看文件指定范围的行内容

### 安全特性
- **自动备份**: 修改前自动创建备份文件
- **文件大小限制**: 可配置最大文件大小限制
- **隐藏文件控制**: 可配置是否允许修改隐藏文件
- **路径验证**: 支持相对路径和绝对路径，自动验证文件访问权限

## 安装和运行

### 1. 安装依赖

```bash
pip install -r file_write_server_requirements.txt
```

### 2. 运行服务器

```bash
python file_write_server.py --port 8080
```

### 3. 配置服务器

服务器启动后，可以通过配置界面设置以下参数：

- **项目根目录**: 设置服务器操作的根目录路径
- **最大文件大小**: 设置允许修改的最大文件大小（MB）
- **启用隐藏文件**: 是否允许修改以点(.)开头的隐藏文件
- **自动备份**: 修改文件前是否自动创建备份

## 工具说明

### 📝 修改单行内容
修改文件中的单行内容。

**参数:**
- `file_path`: 文件路径（支持相对和绝对路径）
- `line_number`: 行号（1-based）
- `new_content`: 新的行内容

### 📝 修改行范围内容
修改文件中指定范围的行内容。

**参数:**
- `file_path`: 文件路径
- `start_line`: 起始行号（1-based）
- `end_line`: 结束行号（1-based，包含）
- `new_content`: 新的内容行列表

### ➕ 插入新行
在指定位置插入新行。

**参数:**
- `file_path`: 文件路径
- `line_number`: 插入位置（在此行号后插入，0表示文件开头）
- `content`: 要插入的内容行列表

### 🗑️ 删除行范围
删除文件中指定范围的行。

**参数:**
- `file_path`: 文件路径
- `start_line`: 起始行号（1-based）
- `end_line`: 结束行号（1-based，包含）

### 📋 批量修改多行
批量修改文件中的多行内容。

**参数:**
- `file_path`: 文件路径
- `modifications`: 修改映射，格式: {行号: 新内容}

### 👀 查看文件行内容
查看文件指定范围的行内容。

**参数:**
- `file_path`: 文件路径
- `start_line`: 起始行号（可选，默认为1）
- `end_line`: 结束行号（可选，默认到文件末尾）

## 使用示例

### 修改单行
```json
{
  "file_path": "test.txt",
  "line_number": 5,
  "new_content": "这是修改后的第5行内容"
}
```

### 修改范围
```json
{
  "file_path": "test.txt",
  "start_line": 3,
  "end_line": 5,
  "new_content": [
    "新的第3行",
    "新的第4行",
    "新的第5行"
  ]
}
```

### 插入行
```json
{
  "file_path": "test.txt",
  "line_number": 10,
  "content": [
    "插入的第一行",
    "插入的第二行"
  ]
}
```

### 批量修改
```json
{
  "file_path": "test.txt",
  "modifications": {
    "3": "修改第3行",
    "7": "修改第7行",
    "12": "修改第12行"
  }
}
```

## 错误处理

服务器会返回详细的错误信息，包括：
- 文件不存在
- 行号超出范围
- 文件大小超过限制
- 权限不足
- 其他文件操作错误

## 备份机制

当启用自动备份时，服务器会在修改文件前创建备份文件，备份文件名格式为：`原文件名.backup`

## 注意事项

1. 行号从1开始计数
2. 修改操作会立即保存到文件
3. 建议在重要文件操作前启用自动备份
4. 大文件操作可能需要较长时间
5. 确保有足够的磁盘空间进行备份操作