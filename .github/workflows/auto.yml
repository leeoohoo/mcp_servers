name: Build MCP Servers (Auto-Discovery)

# è§¦å‘æ¡ä»¶
on:
  push:
    branches: [ main, develop ]
    tags: [ 'v*' ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘
    inputs:
      platforms:
        description: 'Select platforms to build'
        required: false
        default: 'all'
        type: choice
        options:
          - all
          - linux
          - windows
          - macos-intel
          - macos-m1m2

env:
  PYTHON_VERSION: '3.11'

jobs:
  # æœåŠ¡å‘ç°ä½œä¸š
  discover-servers:
    name: Discover MCP Servers
    runs-on: ubuntu-latest
    outputs:
      servers: ${{ steps.discover.outputs.servers }}
      server-count: ${{ steps.discover.outputs.server-count }}

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: ${{ env.PYTHON_VERSION }}

    - name: Discover MCP servers
      id: discover
      run: |
        echo "ğŸ” è‡ªåŠ¨å‘ç° MCP æœåŠ¡å™¨..."
        
        # åˆ›å»ºæœåŠ¡å™¨å‘ç°è„šæœ¬
        cat > discover_servers.py << 'EOF'
        import os
        import json
        import glob
        from pathlib import Path
        
        def find_mcp_servers():
            """è‡ªåŠ¨å‘ç°é¡¹ç›®ä¸­çš„ MCP æœåŠ¡å™¨"""
            servers = []
            
            # æœç´¢æ¨¡å¼ï¼šå¯»æ‰¾åŒ…å« MCP æœåŠ¡å™¨çš„ Python æ–‡ä»¶
            patterns = [
                "*_server/*.py",
                "*_server.py",
                "servers/*/*.py",
                "servers/*.py",
                "mcp_servers/*/*.py",
                "mcp_servers/*.py"
            ]
            
            for pattern in patterns:
                for file_path in glob.glob(pattern, recursive=True):
                    if self.is_mcp_server(file_path):
                        server_info = self.extract_server_info(file_path)
                        if server_info:
                            servers.append(server_info)
            
            return servers
        
        def is_mcp_server(file_path):
            """æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æ˜¯ MCP æœåŠ¡å™¨"""
            try:
                with open(file_path, 'r', encoding='utf-8') as f:
                    content = f.read()
                    # æ£€æŸ¥æ˜¯å¦åŒ…å« MCP ç›¸å…³å¯¼å…¥
                    mcp_indicators = [
                        'from mcp',
                        'import mcp',
                        'FastMCP',
                        'mcp.server',
                        'mcp.types'
                    ]
                    return any(indicator in content for indicator in mcp_indicators)
            except:
                return False
        
        def extract_server_info(file_path):
            """æå–æœåŠ¡å™¨ä¿¡æ¯"""
            path_obj = Path(file_path)
            
            # ç”ŸæˆæœåŠ¡å™¨åç§°
            if path_obj.parent.name.endswith('_server'):
                server_name = path_obj.parent.name.replace('_', '-')
            else:
                server_name = path_obj.stem.replace('_', '-')
            
            # æ£€æŸ¥æ˜¯å¦æœ‰ä¾èµ–æ–‡ä»¶
            requirements_file = None
            possible_req_files = [
                path_obj.parent / f"{path_obj.stem}_requirements.txt",
                path_obj.parent / "requirements.txt",
                path_obj.parent.parent / f"{path_obj.parent.name}_requirements.txt"
            ]
            
            for req_file in possible_req_files:
                if req_file.exists():
                    requirements_file = str(req_file)
                    break
            
            return {
                'name': server_name,
                'script_path': file_path,
                'requirements_file': requirements_file,
                'directory': str(path_obj.parent)
            }
        
        # æ‰§è¡Œå‘ç°
        servers = find_mcp_servers()
        
        print(f"å‘ç° {len(servers)} ä¸ª MCP æœåŠ¡å™¨:")
        for server in servers:
            print(f"  - {server['name']}: {server['script_path']}")
        
        # è¾“å‡ºåˆ° GitHub Actions
        import json
        servers_json = json.dumps(servers)
        print(f"::set-output name=servers::{servers_json}")
        print(f"::set-output name=server-count::{len(servers)}")
        
        # ä¿å­˜åˆ°æ–‡ä»¶ä¾›åç»­æ­¥éª¤ä½¿ç”¨
        with open('discovered_servers.json', 'w') as f:
            json.dump(servers, f, indent=2)
        EOF
        
        python discover_servers.py
      shell: bash

    - name: Upload server discovery results
      uses: actions/upload-artifact@v4
      with:
        name: discovered-servers
        path: discovered_servers.json
        retention-days: 1

  # å¤šå¹³å°æ„å»ºä½œä¸š
  build:
    name: Build on ${{ matrix.platform }}-${{ matrix.arch }}
    runs-on: ${{ matrix.os }}
    needs: discover-servers
    if: needs.discover-servers.outputs.server-count > 0

    strategy:
      fail-fast: false  # å…è®¸éƒ¨åˆ†å¹³å°å¤±è´¥
      matrix:
        include:
          # Linux x86_64
          - os: ubuntu-latest
            platform: linux
            arch: x86_64
            mcp_platform: linux  # ç°åœ¨ä½¿ç”¨æœ¬åœ°æ„å»º
            executable_suffix: ""
            archive_format: tar.gz
            archive_name: mcp-servers-linux-x86_64

          # Windows x86_64
          - os: windows-latest
            platform: windows
            arch: x86_64
            mcp_platform: native
            executable_suffix: .exe
            archive_format: zip
            archive_name: mcp-servers-windows-x86_64

          # macOS Intel x86_64
          - os: macos-13  # Intel Mac
            platform: macos
            arch: x86_64
            mcp_platform: native
            executable_suffix: ""
            archive_format: tar.gz
            archive_name: mcp-servers-macos-intel-x86_64

          # macOS Apple Silicon ARM64 (M1/M2/M3)
          - os: macos-latest  # Apple Silicon Mac
            platform: macos
            arch: arm64
            mcp_platform: native
            executable_suffix: ""
            archive_format: tar.gz
            archive_name: mcp-servers-macos-apple-silicon-arm64

    steps:
    # 1. æ£€å‡ºä»£ç 
    - name: Checkout repository
      uses: actions/checkout@v4

    # 2. ä¸‹è½½æœåŠ¡å™¨å‘ç°ç»“æœ
    - name: Download server discovery results
      uses: actions/download-artifact@v4
      with:
        name: discovered-servers
        path: .

    # 3. è®¾ç½® Python ç¯å¢ƒ
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        cache: 'pip'

    # 4. æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯
    - name: Display system info
      env:
        PYTHONIOENCODING: utf-8
        PYTHONUTF8: 1
      run: |
        echo "ğŸ–¥ï¸  ç³»ç»Ÿä¿¡æ¯:"
        echo "Runner OS: ${{ runner.os }}"
        echo "Platform: ${{ matrix.platform }}-${{ matrix.arch }}"
        echo "MCP Platform: ${{ matrix.mcp_platform }}"
        python --version
        pip --version
        python -c "import platform; print(f'Python å¹³å°: {platform.platform()}'); print(f'æœºå™¨æ¶æ„: {platform.machine()}'); print(f'å¤„ç†å™¨: {platform.processor()}')"
      shell: bash

    # 5. å®‰è£… MCP Framework
    - name: Install MCP Framework
      env:
        PYTHONIOENCODING: utf-8
        PYTHONUTF8: 1
      run: |
        echo "ğŸ“¦ å®‰è£… MCP Framework..."
        python -m pip install --upgrade pip
        if [ "${{ runner.os }}" = "Windows" ]; then
          python -m pip install mcp-framework --no-warn-script-location
        else
          pip install mcp-framework
        fi
      shell: bash

    # 6. å®‰è£…é¡¹ç›®ä¾èµ–
    - name: Install project dependencies
      env:
        PYTHONIOENCODING: utf-8
        PYTHONUTF8: 1
      run: |
        echo "ğŸ“¦ å®‰è£…é¡¹ç›®ä¾èµ–..."
        if [ "${{ runner.os }}" = "Windows" ]; then
          python -m pip install --upgrade pip --no-warn-script-location || echo "pip å‡çº§è·³è¿‡"
        else
          pip install --upgrade pip
        fi
        
        # å®‰è£…åŸºç¡€ä¾èµ–
        if [ -f requirements.txt ]; then
          pip install -r requirements.txt
        fi
        
        # å®‰è£…å‘ç°çš„æœåŠ¡å™¨ç‰¹å®šä¾èµ–
        python << 'EOF'
        import json
        import subprocess
        import sys
        
        try:
            with open('discovered_servers.json', 'r') as f:
                servers = json.load(f)
            
            for server in servers:
                if server.get('requirements_file'):
                    print(f"å®‰è£… {server['name']} çš„ä¾èµ–: {server['requirements_file']}")
                    try:
                        subprocess.run([sys.executable, '-m', 'pip', 'install', '-r', server['requirements_file']], check=True)
                    except subprocess.CalledProcessError as e:
                        print(f"è­¦å‘Š: å®‰è£… {server['name']} ä¾èµ–å¤±è´¥: {e}")
        except Exception as e:
            print(f"ä¾èµ–å®‰è£…è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯: {e}")
        EOF
      shell: bash

    # 7. éªŒè¯ MCP Framework æ„å»ºå·¥å…·
    - name: Verify MCP Framework build tool
      run: |
        echo "ğŸ”§ éªŒè¯ MCP Framework æ„å»ºå·¥å…·..."
        python -m mcp_framework.build --help
        python -m mcp_framework.build --check-docker || echo "Docker æ£€æŸ¥å®Œæˆ"
      shell: bash

    # 8. è‡ªåŠ¨æ„å»ºæ‰€æœ‰å‘ç°çš„æœåŠ¡å™¨
    - name: Build All Discovered Servers
      env:
        PYTHONIOENCODING: utf-8
        PYTHONUTF8: 1
      run: |
        echo "ğŸ”¨ è‡ªåŠ¨æ„å»ºæ‰€æœ‰å‘ç°çš„ MCP æœåŠ¡å™¨..."
        
        python << 'EOF'
        import json
        import subprocess
        import sys
        import os
        from pathlib import Path
        
        try:
            with open('discovered_servers.json', 'r') as f:
                servers = json.load(f)
            
            print(f"å‡†å¤‡æ„å»º {len(servers)} ä¸ªæœåŠ¡å™¨...")
            
            success_count = 0
            failed_servers = []
            
            for server in servers:
                server_name = server['name']
                script_path = server['script_path']
                
                print(f"\n{'='*50}")
                print(f"æ„å»ºæœåŠ¡å™¨: {server_name}")
                print(f"è„šæœ¬è·¯å¾„: {script_path}")
                print(f"å¹³å°: ${{ matrix.mcp_platform }}, æ¶æ„: ${{ matrix.arch }}")
                print(f"{'='*50}")
                
                # æ£€æŸ¥è„šæœ¬æ–‡ä»¶æ˜¯å¦å­˜åœ¨
                if not os.path.exists(script_path):
                    print(f"âŒ è„šæœ¬æ–‡ä»¶ä¸å­˜åœ¨: {script_path}")
                    failed_servers.append(server_name)
                    continue
                
                # åˆ›å»ºç‹¬ç«‹çš„è¾“å‡ºç›®å½•
                output_dir = f"dist/{server_name}"
                os.makedirs(output_dir, exist_ok=True)
                
                # æ„å»ºå‘½ä»¤
                build_cmd = [
                    sys.executable, '-m', 'mcp_framework.build',
                    '--platform', '${{ matrix.mcp_platform }}',
                    '--server', script_path,
                    '--no-test',
                    '--output-dir', output_dir
                ]
                
                try:
                    print(f"æ‰§è¡Œæ„å»ºå‘½ä»¤: {' '.join(build_cmd)}")
                    result = subprocess.run(build_cmd, check=True, capture_output=True, text=True)
                    print(f"âœ… {server_name} æ„å»ºæˆåŠŸ")
                    print(result.stdout)
                    
                    # æŸ¥æ‰¾å¹¶ç§»åŠ¨ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶
                    executable_suffix = "${{ matrix.executable_suffix }}"
                    import glob
                    import shutil
                    
                    # æŸ¥æ‰¾ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶
                    possible_patterns = [
                        f"{output_dir}/{server_name}{executable_suffix}",
                        f"{output_dir}/{server_name}*{executable_suffix}",
                        f"{output_dir}/*{executable_suffix}"
                    ]
                    
                    found_exe = None
                    for pattern in possible_patterns:
                        matches = glob.glob(pattern)
                        if matches:
                            # é€‰æ‹©ç¬¬ä¸€ä¸ªåŒ¹é…çš„æ–‡ä»¶
                            found_exe = matches[0]
                            break
                    
                    if found_exe and os.path.exists(found_exe):
                        # ç”Ÿæˆæœ€ç»ˆæ–‡ä»¶åï¼ˆç®€åŒ–ç‰ˆï¼Œä¸åŒ…å«å¹³å°æ¶æ„ä¿¡æ¯ä»¥é¿å…å½’æ¡£é—®é¢˜ï¼‰
                        final_exe = f"dist/{server_name}{executable_suffix}"
                        
                        # å¦‚æœç›®æ ‡æ–‡ä»¶å·²å­˜åœ¨ï¼Œå…ˆåˆ é™¤
                        if os.path.exists(final_exe):
                            os.remove(final_exe)
                        
                        shutil.move(found_exe, final_exe)
                        print(f"âœ… ç§»åŠ¨å¯æ‰§è¡Œæ–‡ä»¶: {found_exe} -> {final_exe}")
                        
                        # æ¸…ç†ä¸´æ—¶ç›®å½•
                        shutil.rmtree(output_dir)
                    else:
                        print(f"âš ï¸  æ²¡æœ‰æ‰¾åˆ°ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶")
                        print(f"æœç´¢æ¨¡å¼: {possible_patterns}")
                        # åˆ—å‡ºè¾“å‡ºç›®å½•å†…å®¹ä»¥ä¾¿è°ƒè¯•
                        if os.path.exists(output_dir):
                            print(f"è¾“å‡ºç›®å½•å†…å®¹: {os.listdir(output_dir)}")
                    
                    success_count += 1
                    
                except subprocess.CalledProcessError as e:
                    print(f"âŒ {server_name} æ„å»ºå¤±è´¥")
                    print(f"é”™è¯¯è¾“å‡º: {e.stderr}")
                    print(f"æ ‡å‡†è¾“å‡º: {e.stdout}")
                    failed_servers.append(server_name)
                except Exception as e:
                    print(f"âŒ {server_name} æ„å»ºè¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸: {e}")
                    failed_servers.append(server_name)
            
            print(f"\n{'='*50}")
            print(f"æ„å»ºæ‘˜è¦: {success_count}/{len(servers)} ä¸ªæœåŠ¡å™¨æ„å»ºæˆåŠŸ")
            if failed_servers:
                print(f"å¤±è´¥çš„æœåŠ¡å™¨: {', '.join(failed_servers)}")
            print(f"{'='*50}")
            
            # å¦‚æœæ²¡æœ‰ä»»ä½•æœåŠ¡å™¨æ„å»ºæˆåŠŸï¼Œé€€å‡ºå¤±è´¥
            if success_count == 0:
                print("âŒ æ²¡æœ‰ä»»ä½•æœåŠ¡å™¨æ„å»ºæˆåŠŸ")
                sys.exit(1)
                
        except Exception as e:
            print(f"æ„å»ºè¿‡ç¨‹ä¸­å‡ºç°ä¸¥é‡é”™è¯¯: {e}")
            sys.exit(1)
        EOF
      shell: bash

    # 9. æ•´ç†æ„å»ºäº§ç‰©
    - name: Organize build artifacts
      shell: bash
      env:
        PYTHONIOENCODING: utf-8
        PYTHONUTF8: 1
      run: |
        echo "ğŸ“¦ æ•´ç†æ„å»ºäº§ç‰©..."
        
        echo "æœ€ç»ˆæ„å»ºäº§ç‰©:"
        if [ -d "dist" ]; then
          ls -la dist/
        else
          echo "âŒ æ²¡æœ‰æ‰¾åˆ° dist ç›®å½•"
          exit 1
        fi

    # 10. éªŒè¯æ„å»ºäº§ç‰©
    - name: Verify build artifacts
      shell: bash
      run: |
        echo "ğŸ§ª éªŒè¯æ„å»ºäº§ç‰©..."
        
        if [ ! -d "dist" ] || [ -z "$(ls -A dist 2>/dev/null)" ]; then
          echo "âŒ dist ç›®å½•ä¸ºç©ºæˆ–ä¸å­˜åœ¨"
          exit 1
        fi
        
        cd dist
        
        for exe in *${{ matrix.executable_suffix }}; do
          if [ -f "$exe" ]; then
            echo "âœ… æ‰¾åˆ°: $exe"
            
            # æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
            ls -lh "$exe"
            file "$exe" 2>/dev/null || echo "æ–‡ä»¶ç±»å‹æ£€æŸ¥å®Œæˆ"
            
            # ä»…åœ¨æœ¬åœ°æ„å»ºæ—¶æµ‹è¯•å¯æ‰§è¡Œæ–‡ä»¶
            if [ "${{ matrix.mcp_platform }}" = "native" ]; then
              echo "æµ‹è¯•å¯æ‰§è¡Œæ–‡ä»¶: $exe"
              timeout 10s "./$exe" --help || echo "å¸®åŠ©æµ‹è¯•å®Œæˆ: $exe"
            fi
          fi
        done

    # 11. åˆ›å»ºå‘å¸ƒåŒ…
    - name: Create release archive
      shell: bash
      run: |
        echo "ğŸ“¦ åˆ›å»ºå‘å¸ƒåŒ…..."
        cd dist
        
        # æ˜¾ç¤ºè¦æ‰“åŒ…çš„æ–‡ä»¶
        echo "è¦æ‰“åŒ…çš„æ–‡ä»¶:"
        ls -la
        
        # æŸ¥æ‰¾æ‰€æœ‰å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆæ’é™¤ç›®å½•å’Œ.tar.gzæ–‡ä»¶ï¼‰
        echo "æŸ¥æ‰¾å¯æ‰§è¡Œæ–‡ä»¶..."
        executable_files=$(find . -maxdepth 1 -type f -executable ! -name "*.tar.gz" ! -name "*.zip" ! -name "*.txt" ! -name "*.md" | sed 's|^./||' || true)
        
        if [ -z "$executable_files" ]; then
          echo "âŒ æ²¡æœ‰æ‰¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶"
          echo "ç›®å½•å†…å®¹:"
          ls -la
          exit 1
        fi
        
        echo "æ‰¾åˆ°çš„å¯æ‰§è¡Œæ–‡ä»¶:"
        echo "$executable_files"
        
        if [ "${{ matrix.platform }}" = "windows" ]; then
          # Windows ä½¿ç”¨ zip
          if command -v 7z >/dev/null 2>&1; then
            echo "$executable_files" | xargs 7z a ../${{ matrix.archive_name }}.zip
          else
            # åˆ›å»ºä¸´æ—¶æ–‡ä»¶åˆ—è¡¨
            echo "$executable_files" > temp_files.txt
            powershell -Command "\$files = Get-Content temp_files.txt; Compress-Archive -Path \$files -DestinationPath '../${{ matrix.archive_name }}.zip'"
            rm -f temp_files.txt
          fi
        else
          # Linux å’Œ macOS ä½¿ç”¨ tar.gz
          echo "$executable_files" | xargs tar -czf ../${{ matrix.archive_name }}.tar.gz
        fi
        
        cd ..
        echo "âœ… åˆ›å»ºçš„å‘å¸ƒåŒ…:"
        ls -lh ${{ matrix.archive_name }}.* || dir ${{ matrix.archive_name }}.*

    # 12. ä¸Šä¼ æ„å»ºäº§ç‰©
    - name: Upload build artifacts
      uses: actions/upload-artifact@v4
      with:
        name: ${{ matrix.archive_name }}
        path: |
          ${{ matrix.archive_name }}.*
        retention-days: 30
        if-no-files-found: error

    # 13. æ„å»ºæ‘˜è¦
    - name: Build Summary
      run: |
        echo "âœ… ${{ matrix.platform }}-${{ matrix.arch }} æ„å»ºå®Œæˆ"
        echo "ğŸ“ äº§ç‰©å·²ä¸Šä¼ ä¸º: ${{ matrix.archive_name }}"
        echo "ğŸ”§ ä½¿ç”¨çš„æ„å»ºå¹³å°: ${{ matrix.mcp_platform }}"
      shell: bash

  # æ„å»ºçŠ¶æ€æ‘˜è¦
  build-summary:
    needs: [discover-servers, build]
    runs-on: ubuntu-latest
    if: always()
    steps:
    - name: Overall Build Summary
      run: |
        echo "ğŸ¯ MCP æœåŠ¡å™¨è‡ªåŠ¨æ„å»ºæ‘˜è¦"
        echo "=============================="
        echo "å‘ç°çš„æœåŠ¡å™¨æ•°é‡: ${{ needs.discover-servers.outputs.server-count }}"
        echo "æ„å»ºçŠ¶æ€: ${{ needs.build.result }}"
        echo ""
        echo "ğŸ“¦ æ”¯æŒçš„å¹³å°:"
        echo "- Linux x86_64 (æœ¬åœ°æ„å»º)"
        echo "- Windows x86_64 (æœ¬åœ°æ„å»º)"
        echo "- macOS Intel x86_64 (æœ¬åœ°æ„å»º)"
        echo "- macOS Apple Silicon ARM64 (æœ¬åœ°æ„å»º)"
        echo ""
        if [ "${{ needs.build.result }}" = "success" ]; then
          echo "âœ… æ‰€æœ‰å¹³å°æ„å»ºæˆåŠŸï¼"
        else
          echo "âŒ éƒ¨åˆ†å¹³å°æ„å»ºå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—"
        fi

  # åˆ›å»º GitHub Release
  release:
    name: Create Release
    needs: [discover-servers, build]
    runs-on: ubuntu-latest
    if: startsWith(github.ref, 'refs/tags/v') && needs.build.result == 'success'

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Download server discovery results
      uses: actions/download-artifact@v4
      with:
        name: discovered-servers
        path: .

    - name: Download all artifacts
      uses: actions/download-artifact@v4
      with:
        path: artifacts/

    - name: Generate release notes
      id: release-notes
      run: |
        echo "ğŸ“ ç”Ÿæˆå‘å¸ƒè¯´æ˜..."
        
        # è¯»å–å‘ç°çš„æœåŠ¡å™¨ä¿¡æ¯
        python << 'EOF'
        import json
        
        try:
            with open('discovered_servers.json', 'r') as f:
                servers = json.load(f)
            
            server_list = "\n".join([f"          - **{server['name'].replace('-', ' ').title()}** - {server['script_path']}" for server in servers])
            
            release_body = f"""## ğŸš€ MCP Servers Release ${{{{ github.ref_name }}}}
          
          æ­¤ç‰ˆæœ¬åŒ…å« {len(servers)} ä¸ªè‡ªåŠ¨å‘ç°çš„ MCP æœåŠ¡å™¨çš„è·¨å¹³å°æ„å»ºäº§ç‰©ï¼š
          
          ### ğŸ“¦ åŒ…å«çš„æœåŠ¡å™¨
{server_list}

          ### ğŸš€ å¿«é€Ÿå¼€å§‹
          1. ä¸‹è½½é€‚åˆæ‚¨å¹³å°çš„å‹ç¼©åŒ…
          2. è§£å‹ç¼©æ–‡ä»¶
          3. ç›´æ¥è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶
          
          ### ğŸ“‹ å¹³å°æ”¯æŒ
          - **Linux x86_64**: `mcp-servers-linux-x86_64.tar.gz`
          - **Windows x86_64**: `mcp-servers-windows-x86_64.zip`
          - **macOS Intel x86_64**: `mcp-servers-macos-intel-x86_64.tar.gz`
          - **macOS Apple Silicon ARM64 (M1/M2/M3)**: `mcp-servers-macos-apple-silicon-arm64.tar.gz`

          ### ğŸ”§ æ¶æ„è¯´æ˜
          - **Mac M1/M2/M3 ç”¨æˆ·**: ä½¿ç”¨ `macos-apple-silicon-arm64` ç‰ˆæœ¬ä»¥è·å¾—æœ€ä½³æ€§èƒ½
          - **Intel Mac ç”¨æˆ·**: ä½¿ç”¨ `macos-intel-x86_64` ç‰ˆæœ¬
          - **Windows ç”¨æˆ·**: éœ€è¦ Windows 10 æˆ–æ›´é«˜ç‰ˆæœ¬
          - **Linux ç”¨æˆ·**: å…¼å®¹å¤§å¤šæ•°ç°ä»£ Linux å‘è¡Œç‰ˆ

          ### ğŸ› ï¸ æŠ€æœ¯ä¿¡æ¯
          - Python ç‰ˆæœ¬: ${{{{ env.PYTHON_VERSION }}}}
          - æ„å»ºå·¥å…·: MCP Framework (è‡ªåŠ¨å‘ç°)
          - æœåŠ¡å™¨æ•°é‡: {len(servers)}
          - æ„å»ºæ—¶é—´: ${{{{ github.run_number }}}}
          - æäº¤å“ˆå¸Œ: ${{{{ github.sha }}}}

          ### ğŸ¤– è‡ªåŠ¨åŒ–ç‰¹æ€§
          æ­¤ç‰ˆæœ¬ä½¿ç”¨è‡ªåŠ¨æœåŠ¡å™¨å‘ç°åŠŸèƒ½ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®å³å¯æ„å»ºé¡¹ç›®ä¸­çš„æ‰€æœ‰ MCP æœåŠ¡å™¨ã€‚"""

            # ä¿å­˜åˆ°æ–‡ä»¶
            with open('release_body.txt', 'w') as f:
                f.write(release_body)

            print("âœ… å‘å¸ƒè¯´æ˜ç”Ÿæˆå®Œæˆ")

        except Exception as e:
            print(f"ç”Ÿæˆå‘å¸ƒè¯´æ˜æ—¶å‡ºç°é”™è¯¯: {e}")
            # ä½¿ç”¨é»˜è®¤å‘å¸ƒè¯´æ˜
            with open('release_body.txt', 'w') as f:
                f.write("## ğŸš€ MCP Servers Release\n\nè‡ªåŠ¨æ„å»ºçš„ MCP æœåŠ¡å™¨é›†åˆã€‚")
        EOF

    - name: Create Release
      uses: softprops/action-gh-release@v2
      with:
        files: artifacts/*/*
        draft: false
        prerelease: false
        generate_release_notes: true
        body_path: release_body.txt
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}